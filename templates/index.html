{% extends 'base.html' %}
{% block content %}
<h1 class="mb-3">üìÇ Mis carpetas de recetas</h1>

<div class="mb-3">
  <button class="btn btn-sm btn-success" onclick="crearCarpeta()">+ Crear carpeta</button>
</div>

{% if folders %}
<div class="list-group mb-4" id="folders_list">
  {% for f in folders %}
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <!-- Enlace solo sobre el nombre de la carpeta -->
    <a href="{{ url_for('folder', folder_name=f) }}" class="text-decoration-none">üìÅ {{ f }}</a>
    <!-- Bot√≥n separado, sin riesgo de propagar clic al enlace -->
    <button class="btn btn-sm btn-outline-danger ms-2" onclick="eliminarCarpeta('{{ f|escape }}')">Eliminar</button>
  </div>
  {% endfor %}
</div>
{% else %}
<p>No tienes carpetas todav√≠a. A√±ade una receta para empezar.</p>
{% endif %}

<hr>

<h2>√öltimas recetas</h2>
{% if recipes %}
<div class="row g-3">
  {% for r in recipes %}
  <div class="col-md-4">
    <div class="card">
      {% if r.video_url %}
      <video controls class="card-img-top" style="max-height:300px;">
        <source src="{{ r.video_url }}" type="video/mp4">
        Tu navegador no soporta v√≠deo.
      </video>
      {% elif r.image_url %}
      <img src="{{ r.image_url }}" class="card-img-top" alt="imagen receta">
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">{{ r.title or r.caption[:50] }}</h5>
        <p class="card-text"><small class="text-muted">üç≥ {{ r.folder or 'General' }}</small></p>
        <a href="{{ url_for('detail', recipe_id=r.id) }}" class="btn btn-primary btn-sm">Ver</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>No hay recetas a√∫n.</p>
{% endif %}

<script>
  async function crearCarpeta() {
    const name = prompt('Nombre de la nueva carpeta:');
    if (!name) return;
    const resp = await fetch('/folders/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    });
    const data = await resp.json();
    if (data.ok) {
      location.reload();
    } else {
      alert('Error: ' + (data.error || 'no se pudo crear'));
    }
  }

  async function eliminarCarpeta(name) {
    if (!confirm('Eliminar carpeta "' + name + '"? (las recetas quedar√°n sin carpeta)')) return;

    const resp = await fetch('/folders/delete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    });
    const data = await resp.json();
    if (data.ok) {
      location.reload();
    } else {
      alert('Error: ' + (data.error || 'no se pudo eliminar'));
    }
  }
</script>

{% endblock %}